/**
* Name: piroBox v.1.2.2
* Date: May 2010
* Autor: Diego Valobra (http://www.pirolab.it),(http://www.diegovalobra.com)
* Version: 1.2.2
* Licence: CC-BY-SA http://creativecommons.org/licenses/by-sa/2.5/it/
**/(function(e){e.fn.piroBox=function(t){function n(){var n='<tr><td colspan="3" class="pirobox_up"></td></tr><tr><td class="t_l"></td><td class="t_c"></td><td class="t_r"></td></tr><tr><td class="c_l"></td><td class="c_c"><span><span></span></span><div></div></td><td class="c_r"></td></tr><tr><td class="b_l"></td><td class="b_c"></td><td class="b_r"></td></tr><tr><td colspan="3" class="pirobox_down"></td></tr>',r=e(document).height(),i=e(jQuery('<div class="piro_overlay"></div>').hide().css({opacity:+t.bg_alpha,height:r+"px"})),s=e(jQuery('<table class="pirobox_content" cellpadding="0" cellspacing="0"></table>')),o=e(jQuery('<div class="caption"></div>')),u=e(jQuery('<div class="piro_nav"></div>')),a=e(jQuery('<a href="#close" class="piro_close" title="close"></a>')),f=e(jQuery('<a href="#play" class="play" title="play slideshow"></a>')),l=e(jQuery('<a href="#stop" class="stop" title="stop slideshow"></a>')),c=e(jQuery('<a href="#prev" class="piro_prev" title="previous image"></a>')),h=e(jQuery('<a href="#next" class="piro_next" title="next image"></a>'));e("body").append(i).append(s);s.append(n);e(".pirobox_up").append(a);e(".pirobox_down").append(u);e(".pirobox_down").append(f);f.hide();e(".pirobox_down").append(c).append(h);u.append(o);var p=c.width();s.hide();var d=e("a[class^='pirobox']"),v=new Object;for(var m=0;m<d.length;m++){var g=e(d[m]);v["a."+g.attr("class")]=0}var y=new Array;for(var b in v)y.push(b);for(var m=0;m<y.length;m++){e(y[m]).each(function(t){this.rel=t+1+"&nbsp;of&nbsp;"+e(y[m]).length});var w=e(y[m]+":first").addClass("first"),E=e(y[m]+":last").addClass("last")}e(d).each(function(e){this.rev=e+0});var S=e(d).each(function(){this.href}),x=e("body").append('<div id="imgCache" style="display:none"></div').children("#imgCache");e.each(S,function(t,n){e("<div/>").css({background:"url("+n+")"}).appendTo(x)});var T=e(d);e.fn.fixPNG=function(){return this.each(function(){var t=e(this).css("backgroundImage");if(t.match(/^url\(["']?(.*\.png)["']?\)$/i)){t=RegExp.$1;e(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(e(this).css("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+t+"')"}).each(function(){var t=e(this).css("position");t!="absolute"&&t!="relative"&&e(this).css("position","relative")})}})};e.browser.msie6=e.browser.msie&&/MSIE 6\.0/i.test(window.navigator.userAgent);if(e.browser.msie6&&!/MSIE 8\.0/i.test(window.navigator.userAgent)){e(".t_l,.t_c,.t_r,.c_l,.c_r,.b_l,.b_c,.b_r,a.piro_next, a.piro_prev,a.piro_prev_out,a.piro_next_out,.c_c,.piro_close,a.play,a.stop").fixPNG();var N=e(document).height();i.css("height",N+"px")}e.browser.msie&&(t.close_speed=0);e(window).resize(function(){var t=e(document).height();i.css({visibility:"visible",height:+t+"px"})});c.add(h).bind("click",function(t){t.preventDefault();var n=parseInt(e(T).filter(".item").attr("rev")),r=e(this).is(".piro_prev_out,.piro_prev")?e(T).eq(n-1):e(T).eq(n+1);r.size()||(r=e(this).is(".piro_prev_out,.piro_prev")?e(T).eq(e(T).size()-1):e(T).eq(0));r.click();a.add(o).add(h).add(c).css("visibility","hidden")});e(T).each(function(t){var n=e(this);n.unbind();n.bind("click",function(t){t.preventDefault();C(n.attr("href"));var r=n.attr("href"),i=n.attr("title"),s=n.attr("rel");i==""?o.html("<p>"+r+'<em class="number">'+s+"</em></p>"):o.html("<p>"+i+'<em class="number">'+s+"</em></p>");n.is(".last")?e(".number").css("text-decoration","underline"):e(".number").css("text-decoration","none");if(n.is(".first")){c.hide();h.show()}else h.add(c).show();if(n.is(".last")){c.show();h.hide();f.css("width","0")}else f.css("width","40px");if(n.is(".last")&&n.is(".first")){c.add(h).hide();e(".number").hide();f.remove()}e(T).filter(".item").removeClass("item");n.addClass("item");e(".c_c").removeClass("unique")})});var C=function(t){f.add(l).hide();a.add(o).add(h).add(c).css("visibility","hidden");if(s.is(":visible"))e(".c_c div").children().fadeOut(300,function(){e(".c_c div").children().remove();k(t)});else{e(".c_c div").children().remove();s.show();i.fadeIn(300,function(){k(t)})}},k=function(n){if(s.is(".loading"))return;s.addClass("loading");var r=new Image;r.onerror=function(){var t=e(s).height();s.css({marginTop:parseInt(e(document).scrollTop())-t/1.9});e(".c_c div").append('<p class="err_mess">There seems to be an Error:&nbsp;<a href="#close" class="close_pirobox">Close Pirobox</a></p>');e(".close_pirobox").bind("click",function(e){e.preventDefault();a.add(i).add(s).add(o).add(h).add(c).hide(0,function(){r.src=""});s.removeClass("loading")})};r.onload=function(){var n=r.height,i=r.width,u=e(s).height(),p=e(window).height(),d=e(window).width();e(r).height(n).width(i).hide();e(".c_c div").animate({height:n+"px",width:i+"px"},t.my_speed);var v=n/p*2.3;p<n?h_fix=v:h_fix=2;s.animate({height:n+40+"px",width:i+40+"px",marginLeft:"-"+(i/2+20)+"px",marginTop:parseInt(e(document).scrollTop())-n/h_fix},t.my_speed,function(){e(".piro_nav,.caption").css({width:i+"px","margin-bottom":"10px"});e(".piro_nav").css("margin-left","-"+i/2+"px");var n=o.height();e(".c_c div").append(r);a.css("display","block");h.add(c).add(a).css("visibility","visible");o.css({visibility:"visible",display:"block",opacity:"0.8",overflow:"hidden"});s.hover(function(){o.stop().fadeTo(200,.8)},function(){o.stop().fadeTo(200,0)});e(r).fadeIn(300);s.removeClass("loading");t.slideShow===!0?f.add(l).show():f.add(l).hide()})};r.src=n;e("html").bind("keyup",function(t){if(t.keyCode==27){t.preventDefault();if(e(r).is(":visible")||e(".c_c>div>p>a").is(".close_pirobox")){e(T).removeClass("slideshow").removeClass("item");a.add(i).add(s).add(o).add(h).add(c).hide(0,function(){r.src=""});s.removeClass("loading");clearTimeout(v);e(T).children().removeAttr("class");e(".stop").remove();e(".c_c").append(f);e(".sc_menu").css("display","none");e("ul.sc_menu li a").removeClass("img_active").css("opacity","0.4");h.add(c).show().css({top:"50%"});e(T).children().fadeTo(100,1)}}});e("html").bind("keyup",function(t){if(!e(".item").is(".first")&&t.keyCode==37){t.preventDefault();if(e(r).is(":visible")){clearTimeout(v);e(T).children().removeAttr("class");e(".stop").remove();e(".c_c").append(f);c.click()}}});e("html").bind("keyup",function(t){if(!e(".item").is(".last")&&t.keyCode==39){t.preventDefault();if(e(r).is(":visible")){clearTimeout(v);e(T).children().removeAttr("class");e(".stop").remove();e(".c_c").append(f);h.click()}}});var u=e(window).height();l.bind("click",function(t){t.preventDefault();clearTimeout(v);e(T).removeClass("slideshow");e(".stop").remove();e(".pirobox_down").append(f);h.add(c).css("width",p+"px")});f.bind("click",function(t){t.preventDefault();clearTimeout(v);if(e(r).is(":visible")){e(T).addClass("slideshow");e(".play").remove();e(".pirobox_down").append(l)}h.add(c).css({width:"0px"});return d()});e(t.close_all).bind("click",function(t){e(T).removeClass("slideshow");clearTimeout(v);if(e(r).is(":visible")){t.preventDefault();a.add(i).add(s).add(o).add(h).add(c).hide(0,function(){r.src=""});s.removeClass("loading");e(T).removeClass("slideshow");h.add(c).css("width",p+"px").hide();e(".stop").remove();e(".pirobox_down").append(f);f.hide()}});if(t.slideShow===!0){function d(){if(e(T).filter(".item").is(".last")){clearTimeout(v);e(T).removeClass("slideshow");e(".stop").remove();e(".pirobox_down").append(f);h.add(c).css("width",p+"px")}else if(e(T).is(".slideshow")&&e(r).is(":visible")){clearTimeout(v);h.click()}}var v=setInterval(d,t.slideSpeed*1e3)}}}t=jQuery.extend({my_speed:null,close_speed:300,bg_alpha:.5,close_all:".piro_close,.piro_overlay",slideShow:null,slideSpeed:null},t);n()}})(jQuery);